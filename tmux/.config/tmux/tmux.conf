# --- GENERAL -------------------------------------------------------------------

# terminal capabilities for modern TUIs (Yazi, Neovim, etc.)
set-option -g default-terminal "tmux-256color"
set-option -s default-terminal "tmux-256color"
set-option -sa terminal-overrides ",xterm*:Tc"

# mouse
set -g mouse on

# Allow passthrough for image rendering (Claude Code, etc.)
set -g allow-passthrough on

# OSC 8 hyperlinks (clickable file paths in Claude Code, etc.)
set -as terminal-features ",*:hyperlinks"

# OSC 52 clipboard passthrough
set -g set-clipboard on

# extended keys â€” pass through Shift+Enter, Ctrl+J, etc. to apps
set -g extended-keys on
set -as terminal-features ",*:extkeys"

# vi copy mode
setw -g mode-keys vi

# activity monitoring
set -g monitor-activity on
set -g visual-activity on
set -g bell-action any

# scrollback buffer
set -g history-limit 1000000

# window indexing
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# --- PREFIX --------------------------------------------------------------------

set -g prefix C-b

# --- KEYBINDINGS ---------------------------------------------------------------

# Alt-hjkl to switch panes
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# Shift-arrow to switch windows
bind -n S-Left  previous-window
bind -n S-Right next-window

# split panes
bind h split-window -h
bind v split-window -v
unbind '"'
unbind %

# reload config
bind r source-file ~/.config/tmux/tmux.conf \; display "Reloaded!"

# --- PLUGINS -------------------------------------------------------------------

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'catppuccin/tmux'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'fcsonline/tmux-thumbs'
set -g @plugin 'omerxx/tmux-sessionx'
set -g @plugin 'omerxx/tmux-floax'
set -g @plugin 'wfxr/tmux-fzf-url'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# --- CATPPUCCIN THEME ----------------------------------------------------------

# options must be set BEFORE running catppuccin.tmux
set -g @catppuccin_flavor 'mocha'
set -g @catppuccin_window_text "#W"
set -g @catppuccin_window_current_text "#W#{?window_zoomed_flag,(),}"
set -g @catppuccin_window_number_position "right"
set -g @catppuccin_directory_text "#{b:pane_current_path}"

# load catppuccin (must happen before status-left/status-right)
run '~/.config/tmux/plugins/tmux/catppuccin.tmux'

# status bar: session on left, directory on right
set -g status-left-length 100
set -g status-right-length 100
set -g status-left "#{E:@catppuccin_status_session}"
set -g status-right "#{E:@catppuccin_status_directory}"

# --- PLUGIN CONFIGURATION ------------------------------------------------------

# tmux-thumbs
set -g @thumbs-key Space

# tmux-sessionx
set -g @sessionx-bind 'o'
set -g @sessionx-zoxide-mode 'on'
set -g @sessionx-auto-accept 'off'
set -g @sessionx-filter-current 'false'
set -g @sessionx-window-height '85%'
set -g @sessionx-window-width '75%'

# tmux-floax
set -g @floax-bind 'f'
set -g @floax-width '80%'
set -g @floax-height '80%'
set -g @floax-border-color 'magenta'
set -g @floax-text-color 'blue'
set -g @floax-change-path 'true'
set -g @floax-session-name 'scratch'
# Prewarm Floax session in the background so first open is instant.
set-hook -g session-created 'run-shell -b "tmux has-session -t \"#{@floax-session-name}\" 2>/dev/null || { tmux new-session -d -s \"#{@floax-session-name}\" -c \"$HOME\"; tmux set-option -t \"#{@floax-session-name}\" status off; }"'

# tmux-fzf-url
set -g @fzf-url-fzf-options '-p 60%,30% --prompt=" " --border-label=" Open URL "'
set -g @fzf-url-history-limit '2000'

# tmux-resurrect + tmux-continuum
set -g @resurrect-strategy-nvim 'session'
set -g @continuum-restore 'on'

# --- INITIALIZE TPM (keep at very bottom) --------------------------------------

run '~/.config/tmux/plugins/tpm/tpm'

# --- POST-PLUGIN KEY OVERRIDES -------------------------------------------------

# Re-assert terminal profile in case plugins or source order reset it.
set-option -g default-terminal "tmux-256color"
set-option -s default-terminal "tmux-256color"

# detach (remap from default prefix+d to prefix+D)
unbind -T prefix d
bind -T prefix D detach-client

# kill pane without confirmation (remap from default prefix+x prompt)
unbind -T prefix x
bind -T prefix x kill-pane
